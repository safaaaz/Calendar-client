import $ from "jquery";
import { serverAddress } from "./constants";

const list = document.createDocumentFragment();

const initCalendarsSideBar = () => {
  fetch(serverAddress + "/event/share/shareList", {
    method: "GET",
    headers: {
      token: localStorage.getItem("token"),
    },
  })
    .then((response) => {
      if (!response.status == 200) {
        alert("can't fetch calendars");
        return;
      }
      console.log(response);
      return response.json();
    })
    .then((res) => {
      console.log(res);
      let users = res;

      users.map(function (user) {
        let li = document.createElement("li");
        let checkboxInput = document.createElement("input");
        checkboxInput.setAttribute("type", "checkbox");
        checkboxInput.setAttribute("id", `${user.email}`);

        //set checkbox label
        let checkboxLabel = document.createElement("label");
        checkboxLabel.setAttribute("for", `${user.email}`);
        checkboxLabel.innerHTML = `${user.name} (${user.email}) `;

        //set check and uncheck functions
        checkboxInput.onchange = function () {
          if (this.checked) {
            console.log("showing " + `${user.email}` + " calendar");
            //let events = getSharedCalendarByMonth(`${user.email}`, month);
            //foreach event - setAttribute("data-calendar", `${user.email}`)
            //show
          } else {
            console.log("hiding " + `${user.email}` + " calendar");
            //$("body").find(`[data-calendar='${user.email}']`).hide();
          }
        };

        li.appendChild(checkboxInput);
        li.appendChild(checkboxLabel);
        list.appendChild(li);
      });
      $("#sharedCalendars").append(list);
    });
};

export { initCalendarsSideBar };
